# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–í–æ—Ä–æ–Ω–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏**: –û—Ç –¥–µ—à–µ–≤–æ–≥–æ –º–∞—Å—Å–æ–≤–æ–≥–æ —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞ –∫ –¥–æ—Ä–æ–≥–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
3. **–ë–∞—Ç—á–∏–Ω–≥**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI Batch API –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–∞ 50%
4. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤/—Å–æ–æ–±—â–µ–Ω–∏–π

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ messages.sqlite ‚îÇ  ‚Üê –∏—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ dialog_contexts    ‚îÇ  ‚Üê —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—É–º–º–∞—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì (–£—Ä–æ–≤–µ–Ω—å 1: Screening)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ artifact_screening ‚îÇ  ‚Üê –º–µ—Ç–∫–∏ "–µ—Å—Ç—å/–Ω–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã"
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì (—Ñ–∏–ª—å—Ç—Ä: has_artifacts = 1)
         ‚îÇ
         ‚Üì (–£—Ä–æ–≤–µ–Ω—å 2: Extraction)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ artifacts          ‚îÇ  ‚Üê —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì (—Ñ–∏–ª—å—Ç—Ä: artifact_type IN ('commitment', 'deadline'))
         ‚îÇ
         ‚Üì (–£—Ä–æ–≤–µ–Ω—å 3: Status Check)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ artifact_status_checks  ‚îÇ  ‚Üê –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîç –£—Ä–æ–≤–µ–Ω—å 1: –°–∫—Ä–∏–Ω–∏–Ω–≥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

### –¶–µ–ª—å
–ë—ã—Å—Ç—Ä–æ –∏ –¥–µ—à–µ–≤–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.

### –ê–ª–≥–æ—Ä–∏—Ç–º

```python
def screen_context(context: DialogContext) -> ScreeningResult:
    """
    –í—Ö–æ–¥: —Ç–µ–∫—Å—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (300-1000 —Ç–æ–∫–µ–Ω–æ–≤)
    –í—ã—Ö–æ–¥: {"has_artifacts": bool, "types": list, "confidence": float}
    """
    
    # 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–∞
    prompt = build_screening_prompt(context.text)
    
    # 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ batch API (–¥–µ—à–µ–≤–æ: $0.075/$0.30 per 1M tokens)
    response = openai_batch_request(
        model="gpt-4o-mini",
        messages=[{"role": "user", "content": prompt}],
        response_format={"type": "json_object"}
    )
    
    # 3. –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    result = parse_screening_response(response)
    
    # 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    save_screening_result(context.id, result)
    
    return result
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ë–∞—Ç—á–∏–Ω–≥**: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 1000 –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –æ–¥–Ω–∏–º –±–∞—Ç—á–µ–º
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è–µ–º `artifact_screening.screened_at` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
3. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: –°–Ω–∞—á–∞–ª–∞ —Å–≤–µ–∂–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã (ORDER BY message_date DESC)

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **Precision**: ~85% (–∏–∑ –ø–æ–º–µ—á–µ–Ω–Ω—ã—Ö "–µ—Å—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã" –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å)
- **Recall**: ~95% (–Ω–∞—Ö–æ–¥–∏–º –ø–æ—á—Ç–∏ –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: $0.09 –Ω–∞ 1000 –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

## üéØ –£—Ä–æ–≤–µ–Ω—å 2: –î–µ—Ç–∞–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ

### –¶–µ–ª—å
–ò–∑–≤–ª–µ—á—å —Ç–æ—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

### –ê–ª–≥–æ—Ä–∏—Ç–º

```python
def extract_artifacts(screening: ScreeningResult) -> List[Artifact]:
    """
    –í—Ö–æ–¥: screening + –∏—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    –í—ã—Ö–æ–¥: —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
    """
    
    # 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π
    window = calculate_message_window(
        context=screening.context,
        artifact_types=screening.types,
        window_size=100
    )
    
    # 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    messages = load_messages(
        chat_id=screening.chat_id,
        date_from=window.start,
        date_to=window.end
    )
    
    # 3. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è –º–æ–¥–µ–ª–∏
    formatted = format_messages_for_extraction(messages)
    
    # 4. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å
    artifacts = openai_extract(
        model="gpt-4o",
        messages=formatted,
        expected_types=screening.types,
        response_format={"type": "json_object"}
    )
    
    # 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    for artifact in artifacts:
        validate_artifact(artifact)
        save_artifact(artifact)
    
    return artifacts
```

### –£–º–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π

```python
def calculate_message_window(context, artifact_types, window_size=100):
    """
    –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞
    """
    
    base_date = context.message_date
    
    if "commitment" in artifact_types:
        # –î–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤: –Ω–µ–º–Ω–æ–≥–æ –Ω–∞–∑–∞–¥ + –º–Ω–æ–≥–æ –≤–ø–µ—Ä–µ–¥
        return {
            "start": base_date - timedelta(days=2),
            "end": base_date + timedelta(days=14),
            "direction": "forward"
        }
    
    elif "request" in artifact_types:
        # –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤: –∂–¥–µ–º –æ—Ç–≤–µ—Ç
        return {
            "start": base_date - timedelta(days=1),
            "end": base_date + timedelta(days=7),
            "direction": "forward"
        }
    
    elif "decision" in artifact_types:
        # –î–ª—è —Ä–µ—à–µ–Ω–∏–π: –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—Å—É–∂–¥–µ–Ω–∏—è
        return {
            "start": base_date - timedelta(days=7),
            "end": base_date + timedelta(days=1),
            "direction": "backward"
        }
    
    else:
        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ –æ–∫–Ω–æ
        return {
            "start": base_date - timedelta(days=3),
            "end": base_date + timedelta(days=3),
            "direction": "both"
        }
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **Precision**: ~90% (–∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–Ω—ã)
- **Completeness**: ~80% (–∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: $2.20 –Ω–∞ 200 –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

## ‚úÖ –£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

### –¶–µ–ª—å
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∏–ª–∏ –¥–µ–¥–ª–∞–π–Ω.

### –ê–ª–≥–æ—Ä–∏—Ç–º

```python
def check_artifact_status(artifact: Artifact) -> StatusCheck:
    """
    –í—Ö–æ–¥: –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —Å –¥–µ–¥–ª–∞–π–Ω–æ–º
    –í—ã—Ö–æ–¥: –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
    """
    
    # 1. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –¥–µ–¥–ª–∞–π–Ω –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª
    if artifact.due_date > datetime.now():
        return None  # –ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ–∑–∂–µ
    
    # 2. –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ü–û–°–õ–ï –¥–µ–¥–ª–∞–π–Ω–∞
    future_messages = load_messages(
        chat_id=artifact.chat_id,
        date_from=artifact.due_date,
        date_to=artifact.due_date + timedelta(days=14),
        limit=50
    )
    
    # 3. –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å
    status = openai_check_status(
        model="gpt-4o-mini",
        artifact=artifact,
        messages=future_messages
    )
    
    # 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    save_status_check(artifact.id, status)
    
    return status
```

### –≠–≤—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –º–æ–¥–µ–ª—å - –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞:

```python
def heuristic_status_check(artifact: Artifact, messages: List[Message]) -> Optional[str]:
    """–ü—Ä–æ—Å—Ç—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤"""
    
    # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    done_keywords = ["–≥–æ—Ç–æ–≤–æ", "–æ—Ç–ø—Ä–∞–≤–∏–ª", "—Å–¥–µ–ª–∞–ª", "–∑–∞–≤–µ—Ä—à–∏–ª", "done"]
    
    for msg in messages:
        text = msg.text.lower()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
        if artifact.summary.lower() in text:
            # + –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
            if any(kw in text for kw in done_keywords):
                return "fulfilled"
            
            # + –Ω–µ–≥–∞—Ç–∏–≤ = –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
            if any(kw in text for kw in ["–Ω–µ –º–æ–≥—É", "–∑–∞–¥–µ—Ä–∂–∫–∞", "–ø—Ä–æ–±–ª–µ–º–∞"]):
                return "blocked"
    
    # –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –º–æ–¥–µ–ª—å
    return None
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **Accuracy**: ~85% (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å)
- **Coverage**: ~70% (–º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–ª—è 70% –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: $0.03 –Ω–∞ 50 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### `db.py` - –†–∞–±–æ—Ç–∞ —Å –ë–î

```python
class ArtifactDB:
    def __init__(self, db_path: Path):
        self.conn = sqlite3.connect(db_path)
        self.ensure_schema()
    
    def ensure_schema(self):
        """–°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç"""
        self.conn.executescript(SCHEMA_SQL)
    
    def get_unscreened_contexts(self, limit: int = 1000) -> List[DialogContext]:
        """–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –±–µ–∑ —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞"""
        ...
    
    def save_screening(self, context_id: int, result: ScreeningResult):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞"""
        ...
    
    def get_contexts_with_artifacts(self, limit: int = 100) -> List[ScreeningResult]:
        """–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏"""
        ...
    
    def save_artifact(self, artifact: Artifact):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç"""
        ...
    
    def get_artifacts_for_status_check(self) -> List[Artifact]:
        """–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º–∏ –¥–µ–¥–ª–∞–π–Ω–∞–º–∏"""
        ...
```

### `models.py` - –î–∞—Ç–∞–∫–ª–∞—Å—Å—ã

```python
@dataclass
class ScreeningResult:
    context_id: int
    has_artifacts: bool
    artifact_types: List[str]
    confidence: float
    screened_at: datetime

@dataclass
class Artifact:
    id: Optional[int]
    screening_id: int
    chat_id: int
    artifact_type: str
    summary: str
    full_text: Optional[str]
    who: Optional[str]
    whom: Optional[str]
    mentioned_at: datetime
    due_date: Optional[datetime]
    status: str
    priority: str
    confidence: float

@dataclass
class StatusCheck:
    artifact_id: int
    status: str
    status_reason: str
    evidence: Optional[str]
    needs_manual_review: bool
    checked_at: datetime
```

### `prompts.py` - –ü—Ä–æ–º–ø—Ç—ã

```python
def screening_prompt(context_text: str) -> str:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è —É—Ä–æ–≤–Ω—è 1"""
    ...

def extraction_prompt(messages: List[Message], expected_types: List[str]) -> str:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è —É—Ä–æ–≤–Ω—è 2"""
    ...

def status_check_prompt(artifact: Artifact, messages: List[Message]) -> str:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è —É—Ä–æ–≤–Ω—è 3"""
    ...
```

### `batch_utils.py` - Batch API

```python
class BatchProcessor:
    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)
    
    def submit_batch(self, requests: List[Dict]) -> str:
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–∞—Ç—á, –≤–µ—Ä–Ω—É—Ç—å batch_id"""
        ...
    
    def wait_for_completion(self, batch_id: str, poll_interval: int = 60):
        """–ñ–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∞—Ç—á–∞"""
        ...
    
    def download_results(self, batch_id: str) -> List[Dict]:
        """–°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"""
        ...
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

| –≠—Ç–∞–ø                    | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –í—Ä–µ–º—è (batch) | –í—Ä–µ–º—è (sync) |
|------------------------|-----------|---------------|--------------|
| –°–∫—Ä–∏–Ω–∏–Ω–≥ (1000 ctx)    | 1000      | ~2-6 —á–∞—Å–æ–≤    | ~20 –º–∏–Ω—É—Ç    |
| –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (200 ctx)   | 200       | ~1-3 —á–∞—Å–∞     | ~15 –º–∏–Ω—É—Ç    |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ (50) | 50        | ~30-60 –º–∏–Ω—É—Ç  | ~3 –º–∏–Ω—É—Ç—ã    |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏

1. **Batch API**: -50% —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ–≥–¥–∞ –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ)
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –∏–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: —Å–Ω–∞—á–∞–ª–∞ –≤–∞–∂–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
4. **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏**: –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –º–æ–¥–µ–ª–∏

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### –ß—Ç–æ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ OpenAI

- –ò–º–µ–Ω–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤ (–∑–∞–º–µ–Ω—è–µ–º –Ω–∞ "User A", "User B")
- –¢–µ–ª–µ—Ñ–æ–Ω—ã –∏ email (–º–∞—Å–∫–∏—Ä—É–µ–º)
- –ü–ª–∞—Ç–µ–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—É–¥–∞–ª—è–µ–º)
- –ü–∞—Ä–æ–ª–∏ –∏ –∫–ª—é—á–∏ (—Ñ–∏–ª—å—Ç—Ä—É–µ–º)

### –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

- –ü–æ–ª–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è (–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ)
- –°–≤—è–∑–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (–¥–ª—è –∞—É–¥–∏—Ç–∞)

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ

- [ ] –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ >1000 –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
- [ ] –ò–∑–≤–ª–µ—á–µ–Ω–æ >200 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- [ ] –¢–æ—á–Ω–æ—Å—Ç—å >85%
- [ ] –°—Ç–æ–∏–º–æ—Å—Ç—å <$5 –Ω–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ

- [ ] –ù–∞–π–¥–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- [ ] –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Asana —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Dashboard —É–¥–æ–±–µ–Ω –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω

