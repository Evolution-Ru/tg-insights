# Telegram Transcript Pipeline

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –ø–µ—Ä–µ–ø–∏—Å–æ–∫ –∏–∑ Telegram.

> **‚ö†Ô∏è –í–∞–∂–Ω–æ:** –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPT-5 —á–µ—Ä–µ–∑ `responses.create()` API. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `client.responses.create()` –≤–º–µ—Å—Ç–æ `client.chat.completions.create()`.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–Ω–∞–ª–∏–∑–∞

–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
scripts/analysis/
‚îú‚îÄ‚îÄ analyze_farma.py      # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
‚îú‚îÄ‚îÄ compression/          # –°–∂–∞—Ç–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ chunking.py       # –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ –¥–∞—Ç–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ compression.py    # –°–∂–∞—Ç–∏–µ —á–µ—Ä–µ–∑ GPT-5
‚îÇ   ‚îú‚îÄ‚îÄ batch_processing.py # Batch API –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ sliding_window.py # –°–∫–æ–ª—å–∑—è—â–∞—è –≤—ã–∂–∏–º–∫–∞
‚îú‚îÄ‚îÄ embeddings/           # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏
‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ drilldown.py      # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
‚îú‚îÄ‚îÄ extraction/           # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ tasks.py          # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ projects.py       # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ grouping.py       # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
‚îî‚îÄ‚îÄ utils/                # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ db.py             # –†–∞–±–æ—Ç–∞ —Å –ë–î
    ‚îú‚îÄ‚îÄ formatting.py     # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    ‚îú‚îÄ‚îÄ gpt5_client.py    # –ö–ª–∏–µ–Ω—Ç GPT-5
    ‚îî‚îÄ‚îÄ response_parser.py # –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤
```

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

1. **–≠–∫—Å–ø–æ—Ä—Ç** ‚Üí –°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram –≤ SQLite –ë–î
2. **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è** ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. **–ê–Ω–∞–ª–∏–∑** ‚Üí –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
   - –°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –µ–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫
   - –°–∂–∞—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ —á–µ—Ä–µ–∑ GPT-5 (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
   - Drill-down –¥–æ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã** ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `results/farma/`

### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ:

- **Raw messages** ‚Üí –∏—Å—Ö–æ–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **Compressed chunks** ‚Üí —Å–∂–∞—Ç—ã–µ —á–∞—Å—Ç–∏ –ø–æ –¥–∞—Ç–∞–º
- **Summaries** ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤—ã–∂–∏–º–∫–∞ –¥–∏–∞–ª–æ–≥–∞
- **Tasks** ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- **Projects** ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–µ—Ä–µ–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏ (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ SHA256)
- **Batch API** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö (—ç–∫–æ–Ω–æ–º–∏—è –¥–æ 50%)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –±–∞—Ç—á–µ–π
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏** - –¥–æ–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î** - PRAGMA –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì• **–≠–∫—Å–ø–æ—Ä—Ç —Å–æ–æ–±—â–µ–Ω–∏–π** –∏–∑ Telegram –≤ SQLite
- üéôÔ∏è **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ** —á–µ—Ä–µ–∑ T-bank STT (0.3 –∫–æ–ø/—Å–µ–∫) –∏–ª–∏ OpenAI Whisper (3.6 –∫–æ–ø/—Å–µ–∫)
- üìä **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑** —á–µ—Ä–µ–∑ GPT-5 —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
- üîç **Drill-down** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –¥–æ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ö° **Batch API** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/your-username/tg-analyz.git
cd tg-analyz
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
mkdir -p accounts/your_account
# –°–æ–∑–¥–∞—Ç—å accounts/your_account/.env —Å API –∫–ª—é—á–∞–º–∏:
# TELEGRAM_API_ID, TELEGRAM_API_HASH, TELEGRAM_SESSION_STRING
# OPENAI_API_KEY
# TBANK_API_KEY, TBANK_SECRET_KEY (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
python scripts/messages/export_all.py --account your_account --all-dialogs

# –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
python scripts/stt/stt.tbank.py --account your_account --limit 100

# –ê–Ω–∞–ª–∏–∑ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á
python scripts/analysis/analyze_farma.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** `results/farma/extracted/` (–∑–∞–¥–∞—á–∏ –∏ –ø—Ä–æ–µ–∫—Ç—ã –≤ JSON)

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-analyz/
‚îú‚îÄ‚îÄ accounts/{account}/    # –î–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (–ë–î, –º–µ–¥–∏–∞, .env)
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ analysis/         # –ú–æ–¥—É–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ batch/            # –£—Ç–∏–ª–∏—Ç—ã Batch API
‚îÇ   ‚îú‚îÄ‚îÄ messages/         # –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ media/            # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞
‚îÇ   ‚îî‚îÄ‚îÄ stt/              # –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
‚îú‚îÄ‚îÄ results/farma/         # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
‚îî‚îÄ‚îÄ logs/                 # –õ–æ–≥–∏ —Ä–∞–±–æ—Ç—ã
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ú–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∞ (`scripts/analysis/`)

- **Compression** - —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏, —Å–∂–∞—Ç–∏–µ —á–µ—Ä–µ–∑ GPT-5, Batch API
- **Embeddings** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- **Extraction** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
- **Utils** - —Ä–∞–±–æ—Ç–∞ —Å –ë–î, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∏–µ–Ω—Ç GPT-5

### –≠–∫—Å–ø–æ—Ä—Ç (`scripts/messages/export_all.py`)

–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Telegram –≤ SQLite —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (`scripts/stt/`)

- **T-bank STT** - 0.3 –∫–æ–ø/—Å–µ–∫, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ
- **OpenAI Whisper** - 3.6 –∫–æ–ø/—Å–µ–∫, –æ—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

SQLite: `accounts/{account}/messages.sqlite`

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** `messages`, `users`, `dialogs`

## üîß Troubleshooting

**"No module named 'openai'"** ‚Üí `pip install -r requirements.txt`

**"OPENAI_API_KEY not found"** ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `accounts/{account}/.env`

**–°–∫—Ä–∏–ø—Ç –∑–∞–≤–∏—Å–∞–µ—Ç** ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î –Ω–∞ `chat_id` –∏ `date`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [scripts/analysis/README.md](scripts/analysis/README.md) - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è –∞–Ω–∞–ª–∏–∑–∞

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
